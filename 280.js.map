{"version":3,"file":"280.js","mappings":"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","sources":["webpack://@dev/web/../player/src/containers/Filters/index.tsx","webpack://@dev/web/../player/src/containers/index.tsx"],"sourcesContent":["import React, {\n  type Dispatch,\n  type SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { Subject, debounceTime, distinctUntilChanged, map } from \"rxjs\";\n\nconst INITIAL_FILTERS = {\n  search: \"\",\n};\n\ntype FiltersState = typeof INITIAL_FILTERS;\n\nexport const stringifyFilters = ({ search, ...filters }: FiltersState) =>\n  JSON.stringify({\n    ...filters,\n    search: search.toLowerCase().trim(),\n  });\n\nexport const initialQueries = () =>\n  JSON.parse(stringifyFilters(INITIAL_FILTERS));\n\nexport default function Filters({\n  setQueries,\n}: {\n  setQueries: Dispatch<SetStateAction<FiltersState>>;\n}) {\n  const [filters, setFilters] = useState(INITIAL_FILTERS);\n  const search$ = useMemo(() => new Subject<any>(), []);\n\n  useEffect(() => {\n    const subscription = search$\n      .pipe(map(stringifyFilters), distinctUntilChanged(), debounceTime(400))\n      .subscribe((filters) =>\n        setQueries((queries) => ({ ...queries, ...JSON.parse(filters) })),\n      );\n    return () => subscription.unsubscribe();\n  }, [search$]);\n\n  useEffect(() => {\n    search$.next(filters);\n  }, [filters]);\n\n  return (\n    <div>\n      <input\n        type=\"search\"\n        value={filters.search}\n        onChange={useCallback(\n          ({ target }) =>\n            setFilters((filters) => ({\n              ...filters,\n              search: target.value,\n            })),\n          [],\n        )}\n      />\n    </div>\n  );\n}\n","import React, {\n  type ChangeEventHandler,\n  type ComponentProps,\n  type MouseEventHandler,\n  Suspense,\n  useCallback,\n  useMemo,\n  useState,\n} from \"react\";\nimport { suspend } from \"suspend-react\";\n\nimport Filters, { initialQueries } from \"./Filters\";\n\nexport interface MetaType {\n  title: string;\n  album?: string;\n  artist?: string;\n  artwork?: { src: string }[];\n}\n\nexport const Link = ({\n  title,\n  onPress,\n  ...rest\n}: ComponentProps<\"a\"> & {\n  title: string;\n  onPress: MouseEventHandler;\n}) => (\n  <a\n    href=\"#\"\n    onClick={onPress ? (e) => (e.preventDefault(), onPress(e)) : undefined}\n    {...rest}\n  >\n    {title}\n  </a>\n);\n\nconst Text = \"div\";\nconst View = \"div\";\n\nfunction Loading() {\n  return (\n    <View>\n      <Text>Loading...</Text>\n    </View>\n  );\n}\n\nfunction Data({\n  data,\n  expanded: initialExpanded = false,\n}: {\n  data: object;\n  expanded?: boolean;\n}) {\n  const [expanded, setExpanded] = useState(initialExpanded);\n\n  return (\n    <pre>\n      {expanded ? (\n        JSON.stringify(data, null, 2)\n      ) : (\n        <>\n          [\n          <a href=\"#\" onClick={(e) => (e.preventDefault(), setExpanded(true))}>\n            ...\n          </a>\n          ]\n        </>\n      )}\n    </pre>\n  );\n}\n\nconst API_URL = process.env.API_URL || \"\";\n\ninterface ItemType {\n  name: string;\n  year?: string;\n  album?: string;\n  title?: string;\n  artists?: string[];\n  artwork?: MetaType[\"artwork\"];\n  picture?: string[];\n}\n\nfunction Playlist({ version = 1 }) {\n  const [selected, setSelected] = useState<string[]>([]);\n  const [href, setHref] = useState<string | undefined>();\n  const [meta, setMeta] = useState<MetaType | undefined>();\n  const data = suspend(async () => {\n    const res = await fetch(\n      `${API_URL ? `${API_URL}/` : \"\"}api/audio?${version}`,\n    );\n    return res.json() as Promise<ItemType[]>;\n  }, [version]);\n  const [queries, setQueries] = useState(() => initialQueries());\n\n  const handleSelect = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) =>\n      ((id) =>\n        setSelected((selected) =>\n          target.checked\n            ? selected.concat(id)\n            : selected.filter((item) => item !== id),\n        ))(target.value),\n    [],\n  );\n\n  const list = useMemo(\n    () =>\n      (data || []).map(({ name, ...rest }) => ({\n        ...rest,\n        name,\n        href: `${API_URL}/api/audio/${encodeURIComponent(name)}`,\n      })),\n    [data],\n  );\n\n  const handlePlay = useCallback(\n    (id: string) =>\n      (({ name, href, title, album, artists, artwork }) => (\n        setHref(href),\n        setMeta(\n          Object.assign(\n            title\n              ? {\n                  title,\n                  album,\n                  artist: artists.join(\", \"),\n                }\n              : { title: name },\n            artwork && {\n              artwork: artwork.map(({ src, ...artwork }) => ({\n                src: new URL(\n                  `${href}/${src}`,\n                  document.location.origin || \"\",\n                ).toString(),\n                ...artwork,\n              })),\n            },\n          ),\n        ),\n        fetch(`api/player/play/${encodeURIComponent(name)}`)\n      ))(list.find((item) => item.href === id)),\n    [list],\n  );\n\n  const handleStop = useCallback(() => {\n    console.log([\"onStop\"]);\n    setHref(undefined);\n    fetch(`api/player/stop`);\n  }, []);\n\n  const current = href;\n\n  const filtered = useMemo(\n    () =>\n      list.filter((item) =>\n        item.name.toLocaleLowerCase().includes(queries.search),\n      ),\n    [list, queries],\n  );\n\n  console.log({ filtered, list, meta });\n\n  return (\n    <View>\n      <Filters setQueries={setQueries} />\n      <ul>\n        {filtered.map(({ name, href, title, artists, picture }, key) => (\n          <li\n            key={key}\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              padding: 1,\n              alignItems: \"center\",\n              background: href === current ? \"aliceblue\" : \"\",\n            }}\n          >\n            <input\n              type=\"checkbox\"\n              value={href}\n              checked={selected.includes(href)}\n              onChange={handleSelect}\n            />\n            {picture &&\n              picture.map((src, key) => (\n                <img key={key} src={src} width=\"50\" height=\"50\" />\n              ))}\n            <Link\n              style={{ padding: 4 }}\n              title={title ? `${artists.join(\", \")} - ${title}` : name}\n              onPress={() => (setSelected([href]), handlePlay(href))}\n            />\n          </li>\n        ))}\n      </ul>\n      <button onClick={handleStop}>stop</button>\n      <Data data={data} />\n    </View>\n  );\n}\n\nexport default function Audio() {\n  return (\n    <View>\n      <Text>{`API_URL: ${API_URL}`}</Text>\n      {/* <Volume /> */}\n      <Suspense fallback={<Loading />}>\n        <Playlist />\n      </Suspense>\n    </View>\n  );\n}\n"],"names":["INITIAL_FILTERS","search","stringifyFilters","filters","JSON","stringify","toLowerCase","trim","Filters","setQueries","setFilters","useState","search$","useMemo","Subject","useEffect","subscription","pipe","map","distinctUntilChanged","debounceTime","subscribe","queries","parse","unsubscribe","next","React","type","value","onChange","useCallback","target","Link","title","onPress","rest","_extends","href","onClick","e","preventDefault","undefined","View","Loading","Data","data","expanded","initialExpanded","setExpanded","Playlist","version","selected","setSelected","setHref","meta","setMeta","suspend","async","fetch","json","handleSelect","id","checked","concat","filter","item","list","name","encodeURIComponent","handlePlay","album","artists","artwork","Object","assign","artist","join","src","URL","document","location","origin","toString","find","handleStop","console","log","current","filtered","toLocaleLowerCase","includes","picture","key","style","display","flexDirection","padding","alignItems","background","width","height","Audio","Suspense","fallback"],"sourceRoot":""}