{"version":3,"file":"529.js","mappings":"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","sources":["webpack://@dev/web/../status/src/utils/index.ts","webpack://@dev/web/../status/src/containers/index.tsx"],"sourcesContent":["export const getTotal = (usage: string[]) =>\n  Number(\n    ((\n      (usage\n        .map((line) => line.split(/\\s+/))\n        .find((cols) => cols[5].match(/hostname/)) || [])[4] || \"\"\n    ).match(/^(\\d+)%/) || [])[1],\n  );\n","import mqtt from \"mqtt\";\nimport React, { useEffect, useState } from \"react\";\nimport prettyMilliseconds from \"pretty-ms\";\nimport prettyBytes from \"pretty-bytes\";\nimport { createAsset } from \"use-asset\";\nimport type { StatusType } from \"../schema\";\nimport { getTotal } from \"../utils\";\n\nexport const API_URL = process.env.API_URL || \"\";\nexport const MQTT_URL = (({ hostname, protocol }) =>\n  `${protocol}//${hostname}:9001`)(\n  new URL(\n    `${process.env.MQTT_URL || window.location.href}`.replace(\n      /^mqtt:\\/\\//,\n      \"ws://\",\n    ),\n  ),\n);\n\n// https://github.com/pmndrs/use-asset\nconst asset = createAsset(() =>\n  fetch(`${API_URL}status`)\n    .then((res) => res.json())\n    .then<StatusType>(({ result }) => result)\n    .catch(\n      (error) => (\n        console.error(error),\n        {\n          databases: [],\n          usage: [],\n          cpus: [],\n          hostname: null,\n          platform: null,\n          type: null,\n          loadavg: null,\n          freemem: 0,\n          totalmem: 0,\n          uptime: 0,\n        }\n      ),\n    ),\n);\n\nfunction Status() {\n  const [status, setStatus] = useState({});\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_URL);\n\n    console.log({ MQTT_URL });\n\n    client.on(\"connect\", () => {\n      client.subscribe(\"status\", (err) => {\n        // if (!err) {\n        //   client.publish(\"presence\", \"Hello mqtt\");\n        // }\n      });\n    });\n\n    client.on(\"message\", (_topic, message) => {\n      // message is Buffer\n      const result = JSON.parse(message.toString());\n      setStatus((status) => ({\n        ...status,\n        [result.hostname]: result,\n      }));\n    });\n\n    return () => {\n      client.end();\n    };\n  }, []);\n\n  return (\n    <div>\n      <a\n        href=\"http://www.emqx.io/online-mqtt-client\"\n        rel=\"noopener noreferrer\"\n        target=\"_blank\"\n      >\n        online-mqtt-client\n      </a>\n      <pre>{JSON.stringify(status, null, 2)}</pre>\n    </div>\n  );\n}\n\nexport default function Section() {\n  const result = asset.read();\n\n  console.log({ result });\n  console.log({ total: getTotal(result.usage) });\n\n  return (\n    <section>\n      <h2>Status</h2>\n      <Status />\n      <h3>databases</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>name</th>\n            <th>size</th>\n          </tr>\n          {result.databases.map(({ name, size }, key) => (\n            <tr key={key}>\n              <td>{name}</td>\n              <td>{size}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <h3>disks</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>filesystem</th>\n            <th>size</th>\n            <th>used</th>\n            <th>avail</th>\n            <th>capacity</th>\n          </tr>\n          {result.usage.map((line, key) => (\n            <tr key={key}>\n              <td colSpan={5}>{line}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <h3>cpus</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>model</th>\n            <th>speed</th>\n            <th>times</th>\n          </tr>\n          {result.cpus.map(({ model, speed, times }, key) => (\n            <tr key={key}>\n              <td>{model}</td>\n              <td>{speed}</td>\n              <td>\n                <pre>{JSON.stringify(times, null, 2)}</pre>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <h3>host</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>hostname</th>\n            <th>platform</th>\n            <th>type</th>\n            <th>loadavg</th>\n          </tr>\n          {[result].map(({ hostname, platform, type, loadavg }, key) => (\n            <tr key={key}>\n              <td>{hostname}</td>\n              <td>{platform}</td>\n              <td>{type}</td>\n              <td>\n                <pre>{JSON.stringify(loadavg, null, 2)}</pre>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <h3>mem</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>freemem</th>\n            <th>totalmem</th>\n            <th>usage</th>\n          </tr>\n          {[result].map(({ freemem, totalmem }, key) => (\n            <tr key={key}>\n              <td>{prettyBytes(freemem)}</td>\n              <td>{prettyBytes(totalmem)}</td>\n              <td>{prettyBytes(totalmem - freemem)}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <h3>uptime</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>uptime</th>\n          </tr>\n          {[result].map(({ uptime }, key) => (\n            <tr key={key}>\n              <td>{prettyMilliseconds(uptime * 1000)}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <pre>{JSON.stringify(result, null, 2)}</pre>\n    </section>\n  );\n}\n"],"names":["getTotal","usage","Number","map","line","split","find","cols","match","MQTT_URL","hostname","protocol","URL","window","location","href","replace","asset","createAsset","fetch","then","res","json","result","catch","error","console","databases","cpus","platform","type","loadavg","freemem","totalmem","uptime","Status","status","setStatus","useState","useEffect","client","mqtt","connect","log","on","subscribe","err","_topic","message","JSON","parse","toString","end","React","rel","target","stringify","Section","read","total","name","size","key","colSpan","model","speed","times","prettyBytes","prettyMilliseconds"],"sourceRoot":""}