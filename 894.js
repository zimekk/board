"use strict";(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[894],{8894:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var r=n(1855);const a=[];function l(e,t,n=((e,t)=>e===t)){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}const o=(e,t,n)=>function(e,t=null,n=!1,r={}){null===t&&(t=[e]);for(const e of a)if(l(t,e.keys,e.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(e,"error"))throw e.error;if(Object.prototype.hasOwnProperty.call(e,"response"))return r.lifespan&&r.lifespan>0&&(e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(e.remove,r.lifespan)),e.response;if(!n)throw e.promise}const o={keys:t,equal:r.equal,remove:()=>{const e=a.indexOf(o);-1!==e&&a.splice(e,1)},promise:(c=e,"object"==typeof c&&"function"==typeof c.then?e:e(...t)).then((e=>{o.response=e,r.lifespan&&r.lifespan>0&&(o.timeout=setTimeout(o.remove,r.lifespan))})).catch((e=>o.error=e))};var c;if(a.push(o),!n)throw o.promise}(e,t,!1,n);var c=n(6968),s=n(6548),i=n(2216),u=n(2228);const m={search:""},f=({search:e,...t})=>JSON.stringify({...t,search:e.toLowerCase().trim()}),p=()=>JSON.parse(f(m));function d({setQueries:e}){const[t,n]=(0,r.useState)(m),a=(0,r.useMemo)((()=>new c.B),[]);return(0,r.useEffect)((()=>{const t=a.pipe((0,s.T)(f),(0,i.F)(),(0,u.B)(400)).subscribe((t=>e((e=>({...e,...JSON.parse(t)})))));return()=>t.unsubscribe()}),[a]),(0,r.useEffect)((()=>{a.next(t)}),[t]),r.createElement("div",null,r.createElement("input",{type:"search",value:t.search,onChange:(0,r.useCallback)((({target:e})=>n((t=>({...t,search:e.value})))),[])}))}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}const h=({title:e,onPress:t,...n})=>r.createElement("button",v({onClick:t},n),e),E=({title:e,onPress:t,...n})=>r.createElement("a",v({href:"#",onClick:t?e=>(e.preventDefault(),t(e)):void 0},n),e),b="div",g="div";function y({uri:e,loop:t,meta:n,onEnded:a}){const[l,o]=(0,r.useState)(!1),c=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=c.current;if(e){const t=e=>(console.log(["onPlay"],e),o(!0)),n=e=>(console.log(["onPause"],e),o(!1));return e.addEventListener("play",t),e.addEventListener("pause",n),e.addEventListener("ended",a),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n),e.removeEventListener("ended",a)}}}),[c,a]),(0,r.useEffect)((()=>{l&&"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(n))}),[l,n]),r.createElement(g,null,l?r.createElement(h,{title:"Pause",onPress:async function(){c.current&&c.current.pause()}}):r.createElement(h,{title:"Play",onPress:async function(){c.current&&(await c.current.play(),console.log(["play"]))},disabled:!e}),r.createElement("audio",{ref:c,src:e,loop:t,autoPlay:!0,controls:!0}),r.createElement(h,{title:"Forward",onPress:()=>{const e=c.current;e&&e.duration&&(e.currentTime=e.duration-3)},disabled:!c}))}var k=n(5424),w=n(6634);var C=n(9141),S=n(5383);const N=()=>"volume-list";function O(){const[e,t]=(0,r.useState)(NaN);(0,r.useEffect)((()=>{fetch("api/audio/volume").then((e=>e.json())).then((({volume:e})=>e)).then(t)}),[]);const n=(0,r.useMemo)((()=>new c.B),[]);(0,r.useEffect)((()=>{const e=n.pipe((t=1,r=function(e,n){return t<=n},(0,k.N)((function(e,t){var n=0;e.subscribe((0,w._)(t,(function(e){return r.call(void 0,e,n++)&&t.next(e)})))}))),(a=console.log,c=(0,C.T)(a)?{next:a,error:l,complete:o}:a,c?(0,k.N)((function(e,t){var n;null===(n=c.subscribe)||void 0===n||n.call(c);var r=!0;e.subscribe((0,w._)(t,(function(e){var n;null===(n=c.next)||void 0===n||n.call(c,e),t.next(e)}),(function(){var e;r=!1,null===(e=c.complete)||void 0===e||e.call(c),t.complete()}),(function(e){var n;r=!1,null===(n=c.error)||void 0===n||n.call(c,e),t.error(e)}),(function(){var e,t;r&&(null===(e=c.unsubscribe)||void 0===e||e.call(c)),null===(t=c.finalize)||void 0===t||t.call(c)})))})):S.D),(0,i.F)(),(0,u.B)(400)).subscribe((e=>fetch(`api/audio/volume/${e}`).then((e=>e.json())).then(console.log)));var t,r,a,l,o,c;return()=>e.unsubscribe()}),[n]),(0,r.useEffect)((()=>{Number.isNaN(e)||n.next(e)}),[e]);const a=(0,r.useCallback)((({target:e})=>t(Number(e.value))),[]),l=N();return r.createElement("div",null,!Number.isNaN(e)&&r.createElement("input",{type:"range",list:l,min:"0",max:"100",value:e,onChange:a}),r.createElement("datalist",{id:l},[...Array(11)].map(((e,t,n)=>r.createElement("option",{key:t,value:100/(n.length-1)*t})))))}function P(){return r.createElement(g,null,r.createElement(b,null,"Loading..."))}function x({data:e,expanded:t=!1}){const[n,a]=(0,r.useState)(t);return r.createElement("pre",null,n?JSON.stringify(e,null,2):r.createElement(r.Fragment,null,"[",r.createElement("a",{href:"#",onClick:e=>(e.preventDefault(),a(!0))},"..."),"]"))}const j="";function L({version:e=1}){const[t,n]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[c,s]=(0,r.useState)(),[i,u]=(0,r.useState)(),m=o((async()=>(await fetch(`${j?`${j}/`:""}api/audio?${e}`)).json()),[e]),[f,v]=(0,r.useState)((()=>p())),h=(0,r.useCallback)((({target:e})=>{return t=e.value,n((n=>e.checked?n.concat(t):n.filter((e=>e!==t))));var t}),[]),b=(0,r.useMemo)((()=>(m||[]).map((({name:e,...t})=>({...t,name:e,href:`${j}/api/audio/${encodeURIComponent(e)}`})))),[m]),k=(0,r.useCallback)((e=>(({name:e,href:t,title:n,album:r,artists:a,artwork:l})=>(s(t),u(Object.assign(n?{title:n,album:r,artist:a.join(", ")}:{title:e},l&&{artwork:l.map((({src:e,...n})=>({src:new URL(`${t}/${e}`,document.location.origin||"").toString(),...n})))}))))(b.find((t=>t.href===e)))),[b]),w=(0,r.useCallback)((()=>{if(console.log(["onEnded"]),t.length>0){const e=t.indexOf(c)+1;k(e<t.length?t[e]:t[0])}}),[c,t]),C=c,S=(0,r.useMemo)((()=>b.filter((e=>e.name.toLocaleLowerCase().includes(f.search)))),[b,f]);return console.log({filtered:S,list:b,meta:i}),r.createElement(g,null,r.createElement(d,{setQueries:v}),r.createElement("ul",null,S.map((({name:e,href:a,title:l,artists:o,picture:c},s)=>r.createElement("li",{key:s,style:{display:"flex",flexDirection:"row",padding:1,alignItems:"center",background:a===C?"aliceblue":""}},r.createElement("input",{type:"checkbox",value:a,checked:t.includes(a),onChange:h}),c&&c.map(((e,t)=>r.createElement("img",{key:t,src:e,width:"50",height:"50"}))),r.createElement(E,{style:{padding:4},title:l?`${o.join(", ")} - ${l}`:e,onPress:()=>(n([a]),k(a))}))))),r.createElement(y,{uri:c,loop:1===t.length&&t.includes(c),meta:i,onEnded:w}),r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:a,onChange:({target:e})=>l(e.checked)}),r.createElement("span",null,"loop")),r.createElement(x,{data:m}))}function $(){return r.createElement(g,null,r.createElement(b,null,`API_URL: ${j}`),r.createElement(O,null),r.createElement(r.Suspense,{fallback:r.createElement(P,null)},r.createElement(L,null)))}}}]);
//# sourceMappingURL=894.js.map