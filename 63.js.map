{"version":3,"file":"63.js","mappings":"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","sources":["webpack://@dev/web/../share/src/containers/index.tsx"],"sourcesContent":["import mqtt from \"mqtt\";\nimport React, {\n  type ChangeEventHandler,\n  type Dispatch,\n  type SetStateAction,\n  type MouseEventHandler,\n  useCallback,\n  useEffect,\n  useState,\n} from \"react\";\n// import { Spinner } from \"@dev/video/components\";\nimport type { DeviceType, NetworkType } from \"../schema\";\n\nexport const API_URL = process.env.API_URL || \"\";\nexport const MQTT_URL = (({ hostname, protocol }) =>\n  `${protocol}//${hostname}:9001`)(\n  new URL(\n    `${process.env.MQTT_URL || window.location.href}`.replace(\n      /^mqtt:\\/\\//,\n      \"ws://\",\n    ),\n  ),\n);\n\nfunction discover() {\n  fetch(\"share/discover\")\n    .then((res) => res.json())\n    .then(console.info);\n}\n\nfunction Devices({ url }: { url: string }) {\n  const [list, setList] = useState<DeviceType[]>([]);\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_URL);\n\n    console.log({ MQTT_URL });\n\n    client.on(\"connect\", () => {\n      client\n        .subscribe(\"device\", (err) => {})\n        .subscribe(\"device/list\", (err) => {});\n    });\n\n    client.on(\"message\", (topic, message) => {\n      // message is Buffer\n      switch (topic) {\n        case \"device\":\n          const item = JSON.parse(message.toString());\n          setList((list) => list.concat(item));\n          break;\n        case \"device/list\":\n          const list = JSON.parse(message.toString());\n          setList(list);\n          break;\n      }\n    });\n\n    discover();\n\n    return () => {\n      client.end();\n    };\n  }, []);\n\n  const handleClickPlay = useCallback<MouseEventHandler<HTMLButtonElement>>(\n    ({ target }) =>\n      fetch(\"share/play\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ xml: (target as HTMLButtonElement).value, url }),\n      })\n        .then((res) => res.json())\n        .then(console.info),\n    [url],\n  );\n\n  const handleClickDiscover = useCallback<MouseEventHandler<HTMLButtonElement>>(\n    (e) => discover(),\n    [],\n  );\n\n  return (\n    <div>\n      <h3>devices</h3>\n      <button onClick={handleClickDiscover}>discover</button>\n      <table>\n        <tbody>\n          <tr>\n            <th>host</th>\n            <th>name</th>\n            <th>xml</th>\n            <th>type</th>\n            <th></th>\n          </tr>\n          {list.map(({ host, name, xml, type }, key) => (\n            <tr key={key}>\n              <td>{host}</td>\n              <td>{name}</td>\n              <td>\n                <a href={xml} target=\"_blank\">\n                  {xml}\n                </a>\n              </td>\n              <td>{type}</td>\n              <td>\n                <button\n                  disabled={url === \"\"}\n                  value={xml}\n                  onClick={handleClickPlay}\n                >\n                  play\n                </button>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <pre>{JSON.stringify(list, null, 2)}</pre>\n    </div>\n  );\n}\n\nfunction Network() {\n  const [list, setList] = useState<NetworkType[]>([]);\n\n  useEffect(() => {\n    fetch(\"share/networks\")\n      .then((res) => res.json())\n      .then(setList);\n  }, []);\n\n  return (\n    <div>\n      <h3>networks</h3>\n      <table>\n        <tbody>\n          <tr>\n            <th>address</th>\n            <th>family</th>\n            <th>mac</th>\n          </tr>\n          {list.map(({ address, family, mac }, key) => (\n            <tr key={key}>\n              <td>\n                <a\n                  href={(({ hash, pathname, port, protocol }) =>\n                    `${protocol}//${address}:${port}${pathname}${hash}`)(\n                    new URL(document.location.href),\n                  )}\n                >\n                  {address}\n                </a>\n              </td>\n              <td>{family}</td>\n              <td>{mac}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      <pre>{JSON.stringify(list, null, 2)}</pre>\n    </div>\n  );\n}\n\nfunction Media({\n  url,\n  setUrl,\n}: {\n  url: string;\n  setUrl: Dispatch<SetStateAction<string>>;\n}) {\n  const [list, setList] = useState<string[]>([\n    \"http://commondatastorage.googleapis.com/gtv-videos-bucket/big_buck_bunny_1080p.mp4\",\n  ]);\n\n  useEffect(() => {\n    fetch(\"share/list\")\n      .then((res) => res.json())\n      .then((data) =>\n        setList((list) =>\n          list.concat(\n            data.map((name) =>\n              (({ origin }) =>\n                `${origin}/api/audio/${encodeURIComponent(name)}`)(\n                new URL(document.location.href),\n              ),\n            ),\n          ),\n        ),\n      );\n  }, []);\n\n  const handleChange = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) => setUrl(target.value),\n    [],\n  );\n\n  const handleClickAdd = useCallback<MouseEventHandler<HTMLButtonElement>>(\n    (e) =>\n      Promise.resolve(prompt(\"Url:\")).then(\n        (url) => url && (setList((list) => list.concat(url)), setUrl(url)),\n      ),\n    [],\n  );\n\n  return (\n    <div>\n      <h3>media</h3>\n      <button onClick={handleClickAdd}>add</button>\n      <ul>\n        {list.map((name, key) => (\n          <li key={key}>\n            <label>\n              <input\n                type=\"radio\"\n                value={name}\n                onChange={handleChange}\n                checked={name === url}\n              />\n              <span>{name}</span>\n            </label>\n          </li>\n        ))}\n      </ul>\n      <pre>{JSON.stringify(list, null, 2)}</pre>\n    </div>\n  );\n}\n\nexport default function Section() {\n  const [url, setUrl] = useState(\"\");\n\n  return (\n    <section>\n      <h2>Share</h2>\n      <Devices url={url} />\n      <Media url={url} setUrl={setUrl} />\n      <Network />\n    </section>\n  );\n}\n"],"names":["MQTT_URL","hostname","protocol","URL","window","location","href","replace","discover","fetch","then","res","json","console","info","Devices","url","list","setList","useState","useEffect","client","mqtt","connect","log","on","subscribe","err","topic","message","item","JSON","parse","toString","concat","end","handleClickPlay","useCallback","target","method","headers","body","stringify","xml","value","handleClickDiscover","e","React","onClick","map","host","name","type","key","disabled","Network","address","family","mac","hash","pathname","port","document","Media","setUrl","data","origin","encodeURIComponent","handleChange","handleClickAdd","Promise","resolve","prompt","onChange","checked","Section"],"sourceRoot":""}