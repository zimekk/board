"use strict";(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[61],{60061(e,t,n){n.r(t),n.d(t,{default:()=>C});var a=n(10162),l=n(24348),r=n(63638),c=n(14291),s=n(79101),u=n(57315);const o={search:""},i=({search:e,...t})=>JSON.stringify({...t,search:e.toLowerCase().trim()});function m({setQueries:e}){const[t,n]=(0,a.useState)(o),l=(0,a.useMemo)(()=>new r.B,[]);return(0,a.useEffect)(()=>{const t=l.pipe((0,c.T)(i),(0,s.F)(),(0,u.B)(400)).subscribe(t=>e(e=>({...e,...JSON.parse(t)})));return()=>t.unsubscribe()},[l]),(0,a.useEffect)(()=>{l.next(t)},[t]),a.createElement("div",null,a.createElement("input",{type:"search",value:t.search,onChange:(0,a.useCallback)(({target:e})=>n(t=>({...t,search:e.value})),[])}))}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(null,arguments)}const f=({title:e,onPress:t,...n})=>a.createElement("button",d({onClick:t},n),e),p=({title:e,onPress:t,...n})=>a.createElement("a",d({href:"#",onClick:t?e=>(e.preventDefault(),t(e)):void 0},n),e),v="div";function E({uri:e,loop:t,meta:n,onEnded:l}){const[r,c]=(0,a.useState)(!1),s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=s.current;if(e){const t=e=>(console.log(["onPlay"],e),c(!0)),n=e=>(console.log(["onPause"],e),c(!1));return e.addEventListener("play",t),e.addEventListener("pause",n),e.addEventListener("ended",l),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n),e.removeEventListener("ended",l)}}},[s,l]),(0,a.useEffect)(()=>{r&&"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(n))},[r,n]),a.createElement(v,null,r?a.createElement(f,{title:"Pause",onPress:async function(){s.current&&s.current.pause()}}):a.createElement(f,{title:"Play",onPress:async function(){s.current&&(await s.current.play(),console.log(["play"]))},disabled:!e}),a.createElement("audio",{ref:s,src:e,loop:t,autoPlay:!0,controls:!0}),a.createElement(f,{title:"Forward",onPress:()=>{const e=s.current;e&&e.duration&&(e.currentTime=e.duration-3)},disabled:!s}))}var b=n(11183),h=n(91243);var g=n(44848);function y(){const[e,t]=(0,a.useState)(NaN);(0,a.useEffect)(()=>{fetch("api/audio/volume").then(e=>e.json()).then(({volume:e})=>e).then(t)},[]);const n=(0,a.useMemo)(()=>new r.B,[]);(0,a.useEffect)(()=>{const e=n.pipe((t=1,a=function(e,n){return t<=n},(0,b.N)(function(e,t){var n=0;e.subscribe((0,h._)(t,function(e){return a.call(void 0,e,n++)&&t.next(e)}))})),(0,g.M)(console.log),(0,s.F)(),(0,u.B)(400)).subscribe(e=>fetch(`api/audio/volume/${e}`).then(e=>e.json()).then(console.log));var t,a;return()=>e.unsubscribe()},[n]),(0,a.useEffect)(()=>{Number.isNaN(e)||n.next(e)},[e]);const l=(0,a.useCallback)(({target:e})=>t(Number(e.value)),[]),c="volume-list";return a.createElement("div",{style:{display:"flex"}},!Number.isNaN(e)&&a.createElement("div",{style:{display:"flex",alignItems:"center",flex:"auto"}},a.createElement("span",null,"volume"),a.createElement("input",{style:{flex:"auto"},type:"range",list:c,min:"0",max:"100",value:e,onChange:l}),a.createElement("span",null,`${e}%`)),a.createElement("datalist",{id:c},[...Array(11)].map((e,t,n)=>a.createElement("option",{key:t,value:100/(n.length-1)*t}))))}function k(){return a.createElement(v,null,a.createElement("div",null,"Loading..."))}function w({data:e,expanded:t=!1}){const[n,l]=(0,a.useState)(t);return a.createElement("pre",null,n?JSON.stringify(e,null,2):a.createElement(a.Fragment,null,"[",a.createElement("a",{href:"#",onClick:e=>(e.preventDefault(),l(!0))},"..."),"]"))}function x({version:e=1}){const[t,n]=(0,a.useState)([]),[r,c]=(0,a.useState)(!1),[s,u]=(0,a.useState)(),[d,f]=(0,a.useState)(),b=(0,l.DY)(async()=>(await fetch(`api/audio?${e}`)).json(),[e]),[h,g]=(0,a.useState)(()=>JSON.parse(i(o))),y=(0,a.useCallback)(({target:e})=>{return t=e.value,n(n=>e.checked?n.concat(t):n.filter(e=>e!==t));var t},[]),k=(0,a.useMemo)(()=>(b||[]).map(({name:e,...t})=>({...t,name:e,href:`/api/audio/${encodeURIComponent(e)}`})),[b]),x=(0,a.useCallback)(e=>(({name:e,href:t,title:n,album:a,artists:l,artwork:r})=>(u(t),f(Object.assign(n?{title:n,album:a,artist:l.join(", ")}:{title:e},r&&{artwork:r.map(({src:e,...n})=>({src:new URL(`${t}/${e}`,document.location.origin||"").toString(),...n}))}))))(k.find(t=>t.href===e)),[k]),C=(0,a.useCallback)(()=>{if(console.log(["onEnded"]),t.length>0){const e=t.indexOf(s)+1;x(e<t.length?t[e]:t[0])}},[s,t]),S=s,N=(0,a.useMemo)(()=>k.filter(e=>e.name.toLocaleLowerCase().includes(h.search)),[k,h]);return console.log({filtered:N,list:k,meta:d}),a.createElement(v,null,a.createElement(m,{setQueries:g}),a.createElement("ul",null,N.map(({name:e,href:l,title:r,artists:c,picture:s},u)=>a.createElement("li",{key:u,style:{display:"flex",flexDirection:"row",padding:1,alignItems:"center",background:l===S?"aliceblue":""}},a.createElement("input",{type:"checkbox",value:l,checked:t.includes(l),onChange:y}),s&&s.map((e,t)=>a.createElement("img",{key:t,src:e,width:"50",height:"50"})),a.createElement(p,{style:{padding:4},title:r?`${c.join(", ")} - ${r}`:e,onPress:()=>(n([l]),x(l))})))),a.createElement(E,{uri:s,loop:1===t.length&&t.includes(s),meta:d,onEnded:C}),a.createElement("label",null,a.createElement("input",{type:"checkbox",checked:r,onChange:({target:e})=>c(e.checked)}),a.createElement("span",null,"loop")),a.createElement(w,{data:b}))}function C(){return a.createElement(v,null,a.createElement("div",null,"API_URL: "),a.createElement(y,null),a.createElement(a.Suspense,{fallback:a.createElement(k,null)},a.createElement(x,null)))}},44848(e,t,n){n.d(t,{M:()=>s});var a=n(68030),l=n(11183),r=n(91243),c=n(84828);function s(e,t,n){var s=(0,a.T)(e)||t||n?{next:e,error:t,complete:n}:e;return s?(0,l.N)(function(e,t){var n;null===(n=s.subscribe)||void 0===n||n.call(s);var a=!0;e.subscribe((0,r._)(t,function(e){var n;null===(n=s.next)||void 0===n||n.call(s,e),t.next(e)},function(){var e;a=!1,null===(e=s.complete)||void 0===e||e.call(s),t.complete()},function(e){var n;a=!1,null===(n=s.error)||void 0===n||n.call(s,e),t.error(e)},function(){var e,t;a&&(null===(e=s.unsubscribe)||void 0===e||e.call(s)),null===(t=s.finalize)||void 0===t||t.call(s)}))}):c.D}}}]);
//# sourceMappingURL=61.js.map