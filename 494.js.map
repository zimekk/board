{"version":3,"file":"494.js","mappings":"mMAUA,MAAMA,EAAkB,CACtBC,OAAQ,IAKGC,EAAmBA,EAAGD,YAAWE,KAC5CC,KAAKC,UAAU,IACVF,EACHF,OAAQA,EAAOK,cAAcC,SAMlB,SAASC,GAAQ,WAC9BC,IAIA,MAAON,EAASO,IAAcC,EAAAA,EAAAA,UAASX,GACjCY,GAAUC,EAAAA,EAAAA,SAAQ,IAAM,IAAIC,EAAAA,EAAgB,IAelD,OAbAC,EAAAA,EAAAA,WAAU,KACR,MAAMC,EAAeJ,EAClBK,MAAKC,EAAAA,EAAAA,GAAIhB,IAAmBiB,EAAAA,EAAAA,MAAwBC,EAAAA,EAAAA,GAAa,MACjEC,UAAWlB,GACVM,EAAYa,IAAO,IAAWA,KAAYlB,KAAKmB,MAAMpB,OAEzD,MAAO,IAAMa,EAAaQ,eACzB,CAACZ,KAEJG,EAAAA,EAAAA,WAAU,KACRH,EAAQa,KAAKtB,IACZ,CAACA,IAGFuB,EAAAA,cAAA,WACEA,EAAAA,cAAA,SACEC,KAAK,SACLC,MAAOzB,EAAQF,OACf4B,UAAUC,EAAAA,EAAAA,aACR,EAAGC,YACDrB,EAAYP,IAAO,IACdA,EACHF,OAAQ8B,EAAOH,SAEnB,MAKV,C,wNC/CO,MAAMI,EAASA,EACpBC,QACAC,aACGC,KAMHT,EAAAA,cAAA,SAAAU,EAAA,CAAQC,QAASH,GAAaC,GAC3BF,GAIQK,EAAOA,EAClBL,QACAC,aACGC,KAKHT,EAAAA,cAAA,IAAAU,EAAA,CACEG,KAAK,IACLF,QAASH,EAAWM,IAAOA,EAAEC,iBAAkBP,EAAQM,SAAME,GACzDP,GAEHF,GAKQU,EAAO,MAEL,SAASC,GAAO,IAC7BC,EAAG,KACHC,EAAI,KACJC,EAAI,QACJC,IAOA,MAAOC,EAASC,IAAcvC,EAAAA,EAAAA,WAAS,GACjCwC,GAAMC,EAAAA,EAAAA,QAAyB,MA2CrC,OA5BArC,EAAAA,EAAAA,WAAU,KACR,MAAMsC,EAAQF,EAAIG,QAClB,GAAID,EAAO,CACT,MAAME,EAAUf,IAAOgB,QAAQC,IAAI,CAAC,UAAWjB,GAAIU,GAAW,IACxDQ,EAAWlB,IAAOgB,QAAQC,IAAI,CAAC,WAAYjB,GAAIU,GAAW,IAOhE,OAJAG,EAAMM,iBAAiB,OAAQJ,GAC/BF,EAAMM,iBAAiB,QAASD,GAChCL,EAAMM,iBAAiB,QAASX,GAEzB,KACLK,EAAMO,oBAAoB,OAAQL,GAClCF,EAAMO,oBAAoB,QAASF,GACnCL,EAAMO,oBAAoB,QAASZ,GAEvC,GACC,CAACG,EAAKH,KAETjC,EAAAA,EAAAA,WAAU,KACJkC,GAEE,iBAAkBY,YACpBA,UAAUC,aAAaC,SAAW,IAAIC,cAAcjB,KAGvD,CAACE,EAASF,IAGXrB,EAAAA,cAACiB,EAAI,KACFM,EACCvB,EAAAA,cAACM,EAAM,CAACC,MAAM,QAAQC,QArC5B+B,iBACMd,EAAIG,SACNH,EAAIG,QAAQY,OAEhB,IAmCMxC,EAAAA,cAACM,EAAM,CAACC,MAAM,OAAOC,QA9C3B+B,iBACMd,EAAIG,gBACAH,EAAIG,QAAQa,OAClBX,QAAQC,IAAI,CAAC,SAEjB,EAyC0CW,UAAWvB,IAEjDnB,EAAAA,cAAA,SAAOyB,IAAKA,EAAKkB,IAAKxB,EAAKC,KAAMA,EAAMwB,UAAQ,EAACC,UAAQ,IACxD7C,EAAAA,cAACM,EAAM,CACLC,MAAM,UACNC,QAASA,KACP,MAAMmB,EAAQF,EAAIG,QACdD,GAASA,EAAMmB,WACjBnB,EAAMoB,YAAcpB,EAAMmB,SAAW,IAGzCJ,UAAWjB,IAInB,C,yCCjHe,SAASuB,IACtB,MAAOC,EAAQC,IAAajE,EAAAA,EAAAA,UAASkE,MAErC9D,EAAAA,EAAAA,WAAU,KACR+D,MAAM,oBACHC,KAAMC,GAAQA,EAAIC,QAClBF,KAAK,EAAGJ,YAAaA,GACrBI,KAAKH,IACP,IAEH,MAAMM,GAAUrE,EAAAA,EAAAA,SAAQ,IAAM,IAAIC,EAAAA,EAAmB,KAErDC,EAAAA,EAAAA,WAAU,KACR,MAAMC,EAAekE,EAClBjE,MCxBckE,EDyBR,EExBUC,EDAL,SAAUC,EAAGC,GAAS,OAAOH,GAASG,CAAO,GCCpD,OAAQ,SAAUC,EAAQC,GAC7B,IAAIF,EAAQ,EACZC,EAAOlE,WAAU,OAAyBmE,EAAY,SAAU5D,GAAS,OAAOwD,EAAUK,UAHhEC,EAG8E9D,EAAO0D,MAAYE,EAAW/D,KAAKG,EAAQ,GACvJ,KFqBI+D,EAAAA,EAAAA,GAAInC,QAAQC,MACZtC,EAAAA,EAAAA,MACAC,EAAAA,EAAAA,GAAa,MAEdC,UAAWsD,GACVG,MAAM,oBAAoBH,KACvBI,KAAMC,GAAQA,EAAIC,QAClBF,KAAKvB,QAAQC,MCjCjB,IAAc0B,ECCEC,EFkCnB,MAAO,IAAMpE,EAAaQ,eACzB,CAAC0D,KAEJnE,EAAAA,EAAAA,WAAU,KACH6E,OAAOC,MAAMlB,IAChBO,EAAQzD,KAAKkD,IAEd,CAACA,IAEJ,MAAMmB,GAAehE,EAAAA,EAAAA,aACnB,EAAGC,YAAa6C,EAAUgB,OAAO7D,EAAOH,QACxC,IAGImE,EAzCY,cA2ClB,OACErE,EAAAA,cAAA,OAAKsE,MAAO,CAAEC,QAAS,UACnBL,OAAOC,MAAMlB,IACbjD,EAAAA,cAAA,OAAKsE,MAAO,CAAEC,QAAS,OAAQC,WAAY,SAAUC,KAAM,SACzDzE,EAAAA,cAAA,YAAM,UACNA,EAAAA,cAAA,SACEsE,MAAO,CAAEG,KAAM,QACfxE,KAAK,QACLyE,KAAML,EACNM,IAAI,IACJC,IAAI,MACJ1E,MAAO+C,EACP9C,SAAUiE,IAEZpE,EAAAA,cAAA,YAAO,GAAGiD,OAGdjD,EAAAA,cAAA,YAAU6E,GAAIR,GACX,IAAIS,MAAM,KAAStF,IAAI,CAACmE,EAAGC,EAAOmB,IACjC/E,EAAAA,cAAA,UACEgF,IAAKpB,EACL1D,MAAQ,KAAO6E,EAAME,OAAS,GAAMrB,MAMhD,CGlEA,SAASsB,IACP,OACElF,EAAAA,cAACiB,EAAI,KACHjB,EAAAA,cJ8Bc,MI9BT,KAAC,cAGZ,CAEA,SAASmF,GAAK,KACZC,EACAC,SAAUC,GAAkB,IAK5B,MAAOD,EAAUE,IAAetG,EAAAA,EAAAA,UAASqG,GAEzC,OACEtF,EAAAA,cAAA,WACGqF,EACC3G,KAAKC,UAAUyG,EAAM,KAAM,GAE3BpF,EAAAA,cAAAA,EAAAA,SAAA,KAAE,IAEAA,EAAAA,cAAA,KAAGa,KAAK,IAAIF,QAAUG,IAAOA,EAAEC,iBAAkBwE,GAAY,KAAQ,OAEjE,KAMd,CAcA,SAASC,GAAS,QAAEC,EAAU,IAC5B,MAAOC,EAAUC,IAAe1G,EAAAA,EAAAA,UAAmB,KAC5CmC,EAAMwE,IAAW3G,EAAAA,EAAAA,WAAS,IAC1B4B,EAAMgF,IAAW5G,EAAAA,EAAAA,aACjBoC,EAAMyE,IAAW7G,EAAAA,EAAAA,YAClBmG,GAAOW,EAAAA,EAAAA,IAAQxD,gBACDa,MAChB,aAA4CqC,MAEnClC,OACV,CAACkC,KACG7F,EAASb,IAAcE,EAAAA,EAAAA,UAAS,IL/CvCP,KAAKmB,MAAMrB,EAAiBF,KKiDtB0H,GAAe5F,EAAAA,EAAAA,aACnB,EAAGC,aACD,OAAEwE,EAKGxE,EAAOH,MAJVyF,EAAaD,GACXrF,EAAO4F,QACHP,EAASQ,OAAOrB,GAChBa,EAASS,OAAQC,GAASA,IAASvB,IAJ3C,IAAEA,GAMJ,IAGIH,GAAOvF,EAAAA,EAAAA,SACX,KACGiG,GAAQ,IAAI5F,IAAI,EAAG6G,UAAS5F,MAAW,IACnCA,EACH4F,OACAxF,KAAM,cAAwByF,mBAAmBD,QAErD,CAACjB,IAGGmB,GAAanG,EAAAA,EAAAA,aAChByE,GACC,GAAIwB,OAAMxF,OAAMN,QAAOiG,QAAOC,UAASC,cACrCb,EAAQhF,GACRiF,EACEa,OAAOC,OACLrG,EACI,CACEA,QACAiG,QACAK,OAAQJ,EAAQK,KAAK,OAEvB,CAAEvG,MAAO8F,GACbK,GAAW,CACTA,QAASA,EAAQlH,IAAI,EAAGmD,SAAQ+D,MAAc,CAC5C/D,IAAK,IAAIoE,IACP,GAAGlG,KAAQ8B,IACXqE,SAASC,SAASC,QAAU,IAC5BC,cACCT,SAjBb,CAsBGhC,EAAK0C,KAAMhB,GAASA,EAAKvF,OAASgE,IACvC,CAACH,IAGG2C,GAAcjH,EAAAA,EAAAA,aAAY,KAE9B,GADA0B,QAAQC,IAAI,CAAC,YACT2D,EAAST,OAAS,EAAG,CACvB,MAAMrB,EAAQ8B,EAAS4B,QAAQzG,GAAQ,EACvC0F,EAAW3C,EAAQ8B,EAAST,OAASS,EAAS9B,GAAS8B,EAAS,GAClE,GACC,CAAC7E,EAAM6E,IAEJ9D,EAAUf,EAEV0G,GAAWpI,EAAAA,EAAAA,SACf,IACEuF,EAAKyB,OAAQC,GACXA,EAAKC,KAAKmB,oBAAoBC,SAAS7H,EAAQrB,SAEnD,CAACmG,EAAM9E,IAKT,OAFAkC,QAAQC,IAAI,CAAEwF,WAAU7C,OAAMrD,SAG5BrB,EAAAA,cAACiB,EAAI,KACHjB,EAAAA,cAAClB,EAAO,CAACC,WAAYA,IACrBiB,EAAAA,cAAA,UACGuH,EAAS/H,IAAI,EAAG6G,OAAMxF,OAAMN,QAAOkG,UAASiB,WAAW1C,IACtDhF,EAAAA,cAAA,MACEgF,IAAKA,EACLV,MAAO,CACLC,QAAS,OACToD,cAAe,MACfC,QAAS,EACTpD,WAAY,SACZqD,WAAYhH,IAASe,EAAU,YAAc,KAG/C5B,EAAAA,cAAA,SACEC,KAAK,WACLC,MAAOW,EACPoF,QAASP,EAAS+B,SAAS5G,GAC3BV,SAAU6F,IAEX0B,GACCA,EAAQlI,IAAI,CAACmD,EAAKqC,IAChBhF,EAAAA,cAAA,OAAKgF,IAAKA,EAAKrC,IAAKA,EAAKmF,MAAM,KAAKC,OAAO,QAE/C/H,EAAAA,cAACY,EAAI,CACH0D,MAAO,CAAEsD,QAAS,GAClBrH,MAAOA,EAAQ,GAAGkG,EAAQK,KAAK,WAAWvG,IAAU8F,EACpD7F,QAASA,KAAOmF,EAAY,CAAC9E,IAAQ0F,EAAW1F,SAKxDb,EAAAA,cAACkB,EAAM,CACLC,IAAKN,EACLO,KAA0B,IAApBsE,EAAST,QAAgBS,EAAS+B,SAAS5G,GACjDQ,KAAMA,EACNC,QAAS+F,IAEXrH,EAAAA,cAAA,aACEA,EAAAA,cAAA,SACEC,KAAK,WACLgG,QAAS7E,EACTjB,SAAUA,EAAGE,YAAauF,EAAQvF,EAAO4F,WAE3CjG,EAAAA,cAAA,YAAM,SAERA,EAAAA,cAACmF,EAAI,CAACC,KAAMA,IAGlB,CAEe,SAAS4C,IACtB,OACEhI,EAAAA,cAACiB,EAAI,KACHjB,EAAAA,cJtJc,MIsJT,KAAE,aACPA,EAAAA,cAACgD,EAAM,MACPhD,EAAAA,cAACiI,EAAAA,SAAQ,CAACC,SAAUlI,EAAAA,cAACkF,EAAO,OAC1BlF,EAAAA,cAACwF,EAAQ,OAIjB,C,gFCvMO,SAASvB,EAAIkE,EAAgBC,EAAOC,GACvC,IAAIC,GAAc,OAAWH,IAAmBC,GAASC,EAEjD,CAAEtI,KAAMoI,EAAgBC,MAAOA,EAAOC,SAAUA,GAClDF,EACN,OAAOG,GACD,OAAQ,SAAUzE,EAAQC,GACxB,IAAIyE,EAC6B,QAAhCA,EAAKD,EAAY3I,iBAAmC,IAAZ4I,GAAyBA,EAAGxE,KAAKuE,GAC1E,IAAIE,GAAU,EACd3E,EAAOlE,WAAU,OAAyBmE,EAAY,SAAU5D,GAC5D,IAAIqI,EACwB,QAA3BA,EAAKD,EAAYvI,YAA8B,IAAZwI,GAAyBA,EAAGxE,KAAKuE,EAAapI,GAClF4D,EAAW/D,KAAKG,EACpB,EAAG,WACC,IAAIqI,EACJC,GAAU,EACsB,QAA/BD,EAAKD,EAAYD,gBAAkC,IAAZE,GAAyBA,EAAGxE,KAAKuE,GACzExE,EAAWuE,UACf,EAAG,SAAUI,GACT,IAAIF,EACJC,GAAU,EACmB,QAA5BD,EAAKD,EAAYF,aAA+B,IAAZG,GAAyBA,EAAGxE,KAAKuE,EAAaG,GACnF3E,EAAWsE,MAAMK,EACrB,EAAG,WACC,IAAIF,EAAIG,EACJF,IACmC,QAAlCD,EAAKD,EAAYxI,mBAAqC,IAAZyI,GAAyBA,EAAGxE,KAAKuE,IAEhD,QAA/BI,EAAKJ,EAAYK,gBAAkC,IAAZD,GAAyBA,EAAG3E,KAAKuE,EAC7E,GACJ,GAEI,GACZ,C","sources":["webpack://@dev/web/../audio/src/containers/Filters/index.tsx","webpack://@dev/web/../audio/src/containers/Player/index.tsx","webpack://@dev/web/../audio/src/containers/Volume/index.tsx","webpack://@dev/web/../../node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/dist/esm5/internal/operators/skip.js","webpack://@dev/web/../../node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/dist/esm5/internal/operators/filter.js","webpack://@dev/web/../audio/src/containers/index.tsx","webpack://@dev/web/../../node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/dist/esm5/internal/operators/tap.js"],"sourcesContent":["import React, {\n  type Dispatch,\n  type SetStateAction,\n  useEffect,\n  useMemo,\n  useState,\n  useCallback,\n} from \"react\";\nimport { Subject, debounceTime, distinctUntilChanged, map } from \"rxjs\";\n\nconst INITIAL_FILTERS = {\n  search: \"\",\n};\n\ntype FiltersState = typeof INITIAL_FILTERS;\n\nexport const stringifyFilters = ({ search, ...filters }: FiltersState) =>\n  JSON.stringify({\n    ...filters,\n    search: search.toLowerCase().trim(),\n  });\n\nexport const initialQueries = () =>\n  JSON.parse(stringifyFilters(INITIAL_FILTERS));\n\nexport default function Filters({\n  setQueries,\n}: {\n  setQueries: Dispatch<SetStateAction<FiltersState>>;\n}) {\n  const [filters, setFilters] = useState(INITIAL_FILTERS);\n  const search$ = useMemo(() => new Subject<any>(), []);\n\n  useEffect(() => {\n    const subscription = search$\n      .pipe(map(stringifyFilters), distinctUntilChanged(), debounceTime(400))\n      .subscribe((filters) =>\n        setQueries((queries) => ({ ...queries, ...JSON.parse(filters) })),\n      );\n    return () => subscription.unsubscribe();\n  }, [search$]);\n\n  useEffect(() => {\n    search$.next(filters);\n  }, [filters]);\n\n  return (\n    <div>\n      <input\n        type=\"search\"\n        value={filters.search}\n        onChange={useCallback(\n          ({ target }) =>\n            setFilters((filters) => ({\n              ...filters,\n              search: target.value,\n            })),\n          [],\n        )}\n      />\n    </div>\n  );\n}\n","import React, {\n  type ComponentProps,\n  type MouseEventHandler,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nexport interface MetaType {\n  title: string;\n  album?: string;\n  artist?: string;\n  artwork?: { src: string }[];\n}\n\nexport const Button = ({\n  title,\n  onPress,\n  ...rest\n}: {\n  title: string;\n  onPress: MouseEventHandler;\n  disabled?: boolean;\n}) => (\n  <button onClick={onPress} {...rest}>\n    {title}\n  </button>\n);\n\nexport const Link = ({\n  title,\n  onPress,\n  ...rest\n}: ComponentProps<\"a\"> & {\n  title: string;\n  onPress: MouseEventHandler;\n}) => (\n  <a\n    href=\"#\"\n    onClick={onPress ? (e) => (e.preventDefault(), onPress(e)) : undefined}\n    {...rest}\n  >\n    {title}\n  </a>\n);\n\nexport const Text = \"div\";\nexport const View = \"div\";\n\nexport default function Player({\n  uri,\n  loop,\n  meta,\n  onEnded,\n}: {\n  uri: string;\n  loop: boolean;\n  meta: MetaType;\n  onEnded?: () => void;\n}) {\n  const [playing, setPlaying] = useState(false);\n  const ref = useRef<HTMLAudioElement>(null);\n\n  async function play() {\n    if (ref.current) {\n      await ref.current.play();\n      console.log([\"play\"]);\n    }\n  }\n\n  async function pause() {\n    if (ref.current) {\n      ref.current.pause();\n    }\n  }\n\n  useEffect(() => {\n    const audio = ref.current;\n    if (audio) {\n      const onPlay = (e) => (console.log([\"onPlay\"], e), setPlaying(true));\n      const onPause = (e) => (console.log([\"onPause\"], e), setPlaying(false));\n      // const onEnded = (e) => (console.log([\"onEnded\"], e));\n\n      audio.addEventListener(\"play\", onPlay);\n      audio.addEventListener(\"pause\", onPause);\n      audio.addEventListener(\"ended\", onEnded);\n\n      return () => {\n        audio.removeEventListener(\"play\", onPlay);\n        audio.removeEventListener(\"pause\", onPause);\n        audio.removeEventListener(\"ended\", onEnded);\n      };\n    }\n  }, [ref, onEnded]);\n\n  useEffect(() => {\n    if (playing) {\n      // https://web.dev/media-session/\n      if (\"mediaSession\" in navigator) {\n        navigator.mediaSession.metadata = new MediaMetadata(meta);\n      }\n    }\n  }, [playing, meta]);\n\n  return (\n    <View>\n      {playing ? (\n        <Button title=\"Pause\" onPress={pause} />\n      ) : (\n        <Button title=\"Play\" onPress={play} disabled={!uri} />\n      )}\n      <audio ref={ref} src={uri} loop={loop} autoPlay controls />\n      <Button\n        title=\"Forward\"\n        onPress={() => {\n          const audio = ref.current;\n          if (audio && audio.duration) {\n            audio.currentTime = audio.duration - 3;\n          }\n        }}\n        disabled={!ref}\n      />\n    </View>\n  );\n}\n","import React, {\n  type ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { Subject, debounceTime, distinctUntilChanged, skip, tap } from \"rxjs\";\n\nconst useId = () => \"volume-list\";\n\nexport default function Volume() {\n  const [volume, setVolume] = useState(NaN);\n\n  useEffect(() => {\n    fetch(\"api/audio/volume\")\n      .then((res) => res.json())\n      .then(({ volume }) => volume)\n      .then(setVolume);\n  }, []);\n\n  const volume$ = useMemo(() => new Subject<number>(), []);\n\n  useEffect(() => {\n    const subscription = volume$\n      .pipe(\n        skip(1),\n        tap(console.log),\n        distinctUntilChanged(),\n        debounceTime(400),\n      )\n      .subscribe((volume) =>\n        fetch(`api/audio/volume/${volume}`)\n          .then((res) => res.json())\n          .then(console.log),\n      );\n    return () => subscription.unsubscribe();\n  }, [volume$]);\n\n  useEffect(() => {\n    if (!Number.isNaN(volume)) {\n      volume$.next(volume);\n    }\n  }, [volume]);\n\n  const handleChange = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) => setVolume(Number(target.value)),\n    [],\n  );\n\n  const listId = useId();\n\n  return (\n    <div style={{ display: \"flex\" }}>\n      {!Number.isNaN(volume) && (\n        <div style={{ display: \"flex\", alignItems: \"center\", flex: \"auto\" }}>\n          <span>volume</span>\n          <input\n            style={{ flex: \"auto\" }}\n            type=\"range\"\n            list={listId}\n            min=\"0\"\n            max=\"100\"\n            value={volume}\n            onChange={handleChange}\n          />\n          <span>{`${volume}%`}</span>\n        </div>\n      )}\n      <datalist id={listId}>\n        {[...Array(10 + 1)].map((_, index, array) => (\n          <option\n            key={index}\n            value={(100 / (array.length - 1)) * index}\n          ></option>\n        ))}\n      </datalist>\n    </div>\n  );\n}\n","import { filter } from './filter';\nexport function skip(count) {\n    return filter(function (_, index) { return count <= index; });\n}\n//# sourceMappingURL=skip.js.map","import { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nexport function filter(predicate, thisArg) {\n    return operate(function (source, subscriber) {\n        var index = 0;\n        source.subscribe(createOperatorSubscriber(subscriber, function (value) { return predicate.call(thisArg, value, index++) && subscriber.next(value); }));\n    });\n}\n//# sourceMappingURL=filter.js.map","import React, {\n  type ChangeEventHandler,\n  Suspense,\n  useCallback,\n  useMemo,\n  useState,\n} from \"react\";\nimport { suspend } from \"suspend-react\";\n\nimport Filters, { initialQueries } from \"./Filters\";\nimport Player, { MetaType, Link, Text, View } from \"./Player\";\nimport Volume from \"./Volume\";\n\nfunction Loading() {\n  return (\n    <View>\n      <Text>Loading...</Text>\n    </View>\n  );\n}\n\nfunction Data({\n  data,\n  expanded: initialExpanded = false,\n}: {\n  data: object;\n  expanded?: boolean;\n}) {\n  const [expanded, setExpanded] = useState(initialExpanded);\n\n  return (\n    <pre>\n      {expanded ? (\n        JSON.stringify(data, null, 2)\n      ) : (\n        <>\n          [\n          <a href=\"#\" onClick={(e) => (e.preventDefault(), setExpanded(true))}>\n            ...\n          </a>\n          ]\n        </>\n      )}\n    </pre>\n  );\n}\n\nconst API_URL = process.env.API_URL || \"\";\n\ninterface ItemType {\n  name: string;\n  year?: string;\n  album?: string;\n  title?: string;\n  artists?: string[];\n  artwork?: MetaType[\"artwork\"];\n  picture?: string[];\n}\n\nfunction Playlist({ version = 1 }) {\n  const [selected, setSelected] = useState<string[]>([]);\n  const [loop, setLoop] = useState(false);\n  const [href, setHref] = useState<string | undefined>();\n  const [meta, setMeta] = useState<MetaType | undefined>();\n  const data = suspend(async () => {\n    const res = await fetch(\n      `${API_URL ? `${API_URL}/` : \"\"}api/audio?${version}`,\n    );\n    return res.json() as Promise<ItemType[]>;\n  }, [version]);\n  const [queries, setQueries] = useState(() => initialQueries());\n\n  const handleSelect = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) =>\n      ((id) =>\n        setSelected((selected) =>\n          target.checked\n            ? selected.concat(id)\n            : selected.filter((item) => item !== id),\n        ))(target.value),\n    [],\n  );\n\n  const list = useMemo(\n    () =>\n      (data || []).map(({ name, ...rest }) => ({\n        ...rest,\n        name,\n        href: `${API_URL}/api/audio/${encodeURIComponent(name)}`,\n      })),\n    [data],\n  );\n\n  const handlePlay = useCallback(\n    (id: string) =>\n      (({ name, href, title, album, artists, artwork }) => (\n        setHref(href),\n        setMeta(\n          Object.assign(\n            title\n              ? {\n                  title,\n                  album,\n                  artist: artists.join(\", \"),\n                }\n              : { title: name },\n            artwork && {\n              artwork: artwork.map(({ src, ...artwork }) => ({\n                src: new URL(\n                  `${href}/${src}`,\n                  document.location.origin || \"\",\n                ).toString(),\n                ...artwork,\n              })),\n            },\n          ),\n        )\n      ))(list.find((item) => item.href === id)),\n    [list],\n  );\n\n  const handleEnded = useCallback(() => {\n    console.log([\"onEnded\"]);\n    if (selected.length > 0) {\n      const index = selected.indexOf(href) + 1;\n      handlePlay(index < selected.length ? selected[index] : selected[0]);\n    }\n  }, [href, selected]);\n\n  const current = href;\n\n  const filtered = useMemo(\n    () =>\n      list.filter((item) =>\n        item.name.toLocaleLowerCase().includes(queries.search),\n      ),\n    [list, queries],\n  );\n\n  console.log({ filtered, list, meta });\n\n  return (\n    <View>\n      <Filters setQueries={setQueries} />\n      <ul>\n        {filtered.map(({ name, href, title, artists, picture }, key) => (\n          <li\n            key={key}\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              padding: 1,\n              alignItems: \"center\",\n              background: href === current ? \"aliceblue\" : \"\",\n            }}\n          >\n            <input\n              type=\"checkbox\"\n              value={href}\n              checked={selected.includes(href)}\n              onChange={handleSelect}\n            />\n            {picture &&\n              picture.map((src, key) => (\n                <img key={key} src={src} width=\"50\" height=\"50\" />\n              ))}\n            <Link\n              style={{ padding: 4 }}\n              title={title ? `${artists.join(\", \")} - ${title}` : name}\n              onPress={() => (setSelected([href]), handlePlay(href))}\n            />\n          </li>\n        ))}\n      </ul>\n      <Player\n        uri={href}\n        loop={selected.length === 1 && selected.includes(href)}\n        meta={meta}\n        onEnded={handleEnded}\n      />\n      <label>\n        <input\n          type=\"checkbox\"\n          checked={loop}\n          onChange={({ target }) => setLoop(target.checked)}\n        />\n        <span>loop</span>\n      </label>\n      <Data data={data} />\n    </View>\n  );\n}\n\nexport default function Audio() {\n  return (\n    <View>\n      <Text>{`API_URL: ${API_URL}`}</Text>\n      <Volume />\n      <Suspense fallback={<Loading />}>\n        <Playlist />\n      </Suspense>\n    </View>\n  );\n}\n","import { isFunction } from '../util/isFunction';\nimport { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nimport { identity } from '../util/identity';\nexport function tap(observerOrNext, error, complete) {\n    var tapObserver = isFunction(observerOrNext) || error || complete\n        ?\n            { next: observerOrNext, error: error, complete: complete }\n        : observerOrNext;\n    return tapObserver\n        ? operate(function (source, subscriber) {\n            var _a;\n            (_a = tapObserver.subscribe) === null || _a === void 0 ? void 0 : _a.call(tapObserver);\n            var isUnsub = true;\n            source.subscribe(createOperatorSubscriber(subscriber, function (value) {\n                var _a;\n                (_a = tapObserver.next) === null || _a === void 0 ? void 0 : _a.call(tapObserver, value);\n                subscriber.next(value);\n            }, function () {\n                var _a;\n                isUnsub = false;\n                (_a = tapObserver.complete) === null || _a === void 0 ? void 0 : _a.call(tapObserver);\n                subscriber.complete();\n            }, function (err) {\n                var _a;\n                isUnsub = false;\n                (_a = tapObserver.error) === null || _a === void 0 ? void 0 : _a.call(tapObserver, err);\n                subscriber.error(err);\n            }, function () {\n                var _a, _b;\n                if (isUnsub) {\n                    (_a = tapObserver.unsubscribe) === null || _a === void 0 ? void 0 : _a.call(tapObserver);\n                }\n                (_b = tapObserver.finalize) === null || _b === void 0 ? void 0 : _b.call(tapObserver);\n            }));\n        })\n        :\n            identity;\n}\n//# sourceMappingURL=tap.js.map"],"names":["INITIAL_FILTERS","search","stringifyFilters","filters","JSON","stringify","toLowerCase","trim","Filters","setQueries","setFilters","useState","search$","useMemo","Subject","useEffect","subscription","pipe","map","distinctUntilChanged","debounceTime","subscribe","queries","parse","unsubscribe","next","React","type","value","onChange","useCallback","target","Button","title","onPress","rest","_extends","onClick","Link","href","e","preventDefault","undefined","View","Player","uri","loop","meta","onEnded","playing","setPlaying","ref","useRef","audio","current","onPlay","console","log","onPause","addEventListener","removeEventListener","navigator","mediaSession","metadata","MediaMetadata","async","pause","play","disabled","src","autoPlay","controls","duration","currentTime","Volume","volume","setVolume","NaN","fetch","then","res","json","volume$","count","predicate","_","index","source","subscriber","call","thisArg","tap","Number","isNaN","handleChange","listId","style","display","alignItems","flex","list","min","max","id","Array","array","key","length","Loading","Data","data","expanded","initialExpanded","setExpanded","Playlist","version","selected","setSelected","setLoop","setHref","setMeta","suspend","handleSelect","checked","concat","filter","item","name","encodeURIComponent","handlePlay","album","artists","artwork","Object","assign","artist","join","URL","document","location","origin","toString","find","handleEnded","indexOf","filtered","toLocaleLowerCase","includes","picture","flexDirection","padding","background","width","height","Audio","Suspense","fallback","observerOrNext","error","complete","tapObserver","_a","isUnsub","err","_b","finalize"],"sourceRoot":""}