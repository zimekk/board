{"version":3,"file":"410.js","mappings":"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","sources":["webpack://@dev/web/../stream/src/schema/index.ts","webpack://@dev/web/../stream/src/containers/index.tsx"],"sourcesContent":["import { z } from \"zod\";\n\nexport const StreamsSchema = z.object({\n  live: z\n    .record(\n      z.object({\n        publisher: z.object({\n          app: z.string(),\n          stream: z.string(),\n          clientId: z.string(),\n          connectCreated: z.string(),\n          bytes: z.number(),\n          ip: z.string(),\n          audio: z\n            .object({\n              codec: z.string(),\n              profile: z.string(),\n              samplerate: z.number(),\n              channels: z.number(),\n            })\n            .nullable(),\n          video: z.object({\n            codec: z.string(),\n            width: z.number(),\n            height: z.number(),\n            profile: z.string(),\n            level: z.number(),\n            fps: z.number(),\n          }),\n        }),\n        subscribers: z.array(z.unknown()),\n      }),\n    )\n    .optional(),\n});\n","// import flvjs from \"pro-flv.js\";\nimport flvjs from \"mpegts.js\";\nimport React, {\n  ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { StreamsSchema } from \"../schema\";\n\nexport const MEDIA_URL =\n  process.env.MEDIA_URL ||\n  (({ protocol, hostname }) => `${protocol}//${hostname}:7000`)(\n    new URL(window.location.href),\n  );\n\n// https://github.com/illuspas/Node-Media-Server\nfunction Stream({ stream: url }: { stream: string }) {\n  const [error, setError] = useState<object>(null);\n  const videoRef = useRef();\n\n  useEffect(() => {\n    // https://github.com/illuspas/pro-fiv.js\n    if (flvjs.isSupported()) {\n      const video = videoRef.current;\n      const flvPlayer = flvjs.createPlayer({\n        type: \"flv\",\n        url,\n      });\n      flvPlayer.attachMediaElement(video);\n      flvPlayer.on(flvjs.Events.ERROR, setError);\n      flvPlayer.load();\n      // flvPlayer.play();\n    }\n  }, [url]);\n\n  return (\n    <div>\n      <video ref={videoRef} width=\"480\" height=\"270\" autoPlay controls></video>\n      {error && (\n        <pre\n          style={{\n            background: \"crimson\",\n            color: \"white\",\n            margin: \".5em\",\n            padding: \"1em\",\n          }}\n        >\n          {JSON.stringify(error)}\n        </pre>\n      )}\n    </div>\n  );\n}\n\nfunction MJPEGStream({ stream: url }: { stream: string }) {\n  return (\n    <div>\n      <video\n        crossOrigin=\"anonymous\"\n        src={url}\n        width=\"480\"\n        height=\"270\"\n        autoPlay\n        controls\n      ></video>\n    </div>\n  );\n}\n\nexport default function Section() {\n  const [list, setList] = useState<string[] | null>(null);\n  const [stream, setStream] = useState(null);\n\n  useEffect(() => {\n    (window\n      ? Promise.resolve({\n          live: {\n            NZXT: {},\n          },\n        })\n      : fetch(`${MEDIA_URL}/api/streams`, {\n          headers: {\n            Authorization: `Basic ${btoa([\"admin\", \"admin\"].join(\":\"))}`,\n          },\n        })\n          .then((res) => res.json())\n          .then(StreamsSchema.parseAsync)\n    )\n      .then((data) =>\n        Object.keys(data.live || {}).map(\n          (name) => `${MEDIA_URL}/live/${name}.flv`,\n        ),\n      )\n      // .then((list) => [\"http://192.168.2.23:8080/feed.flv\", ...list])\n      .then((list) => list.length > 0 && (setList(list), setStream(list[0])));\n  }, []);\n\n  const handleChangeStream = useCallback<ChangeEventHandler<HTMLSelectElement>>(\n    ({ target }) => setStream(target.value),\n    [],\n  );\n\n  return (\n    <section>\n      <h2>Stream</h2>\n      {stream && list && (\n        <select value={stream} onChange={handleChangeStream}>\n          {list.map((url) => (\n            <option key={url} value={url}>\n              {url}\n            </option>\n          ))}\n        </select>\n      )}\n      {stream && <Stream stream={stream} />}\n      <a href={`${MEDIA_URL}/admin/streams`} target=\"_blank\">\n        streams\n      </a>\n      <pre style={{ background: \"linen\", margin: \".5em\", padding: \"1em\" }}>\n        {`~ $ git clone https://github.com/illuspas/Node-Media-Server\n\n~/Node-Media-Server $ docker build . -t nms\n~/Node-Media-Server $ docker run --name nms -d -p 1935:1935 -p 7000:8000 -p 8443:8443 nms\n`}\n      </pre>\n      {stream && (\n        <pre style={{ background: \"linen\", margin: \".5em\", padding: \"1em\" }}>\n          {`ffmpeg -stream_loop -1 -re -i share/library/BilaShsQphM.mp4 -c copy -f flv ${((url) => `rtmp://${url.hostname}${url.pathname.split(\".\")[0]}`)(new URL(stream))}\n`}\n        </pre>\n      )}\n      <h2>MJPEGStream</h2>\n      <MJPEGStream stream=\"//192.168.2.23:8080/feed.mjpg\" />\n      <pre style={{ background: \"linen\", margin: \".5em\", padding: \"1em\" }}>\n        {`gphoto2 --set-config viewfinder=1\ngphoto2 --capture-movie --stdout | ffmpeg -re -i pipe:0 -pix_fmt yuv420p -s:v 1920x1080 -listen 1 -headers \"Access-Control-Allow-Origin: *\" -f mjpeg http://192.168.2.23:8080/feed.mjpg\n`}\n      </pre>\n    </section>\n  );\n}\n"],"names":["StreamsSchema","z","live","publisher","app","stream","clientId","connectCreated","bytes","ip","audio","codec","profile","samplerate","channels","nullable","video","width","height","level","fps","subscribers","optional","MEDIA_URL","protocol","hostname","URL","window","location","href","Stream","url","error","setError","useState","videoRef","useRef","useEffect","flvjs","current","flvPlayer","type","attachMediaElement","on","ERROR","load","React","ref","autoPlay","controls","style","background","color","margin","padding","JSON","stringify","MJPEGStream","crossOrigin","src","Section","list","setList","setStream","Promise","resolve","NZXT","fetch","headers","Authorization","btoa","join","then","res","json","parseAsync","data","Object","keys","map","name","length","handleChangeStream","useCallback","target","value","onChange","key","pathname","split"],"sourceRoot":""}